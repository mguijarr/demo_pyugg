<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Introduction to <strong>gevent</strong></title>
    <!-- Styles -->
    
    <link rel="stylesheet" media="print" href="file:///usr/local/lib/python2.7/dist-packages/landslide-1.1.1-py2.7.egg/landslide/themes/default/css/print.css">
    <link rel="stylesheet" media="screen, projection" href="file:///usr/local/lib/python2.7/dist-packages/landslide-1.1.1-py2.7.egg/landslide/themes/default/css/screen.css">
    
    
    <!-- /Styles -->
    <!-- Javascripts -->
    
    <script type="text/javascript" src="file:///usr/local/lib/python2.7/dist-packages/landslide-1.1.1-py2.7.egg/landslide/themes/default/js/slides.js"></script>
    
    
    <!-- /Javascripts -->
</head>
<body>
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Introduction to <strong>gevent</strong></h1></header>
            
            
            <section><h2>One of the best kept secrets of Python</h2>
<p><em>by Matias Guijarro</em></p>
<h4>Grenoble Python Users Meeting, 16/04/2014</h4></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              1/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>A refresher on Concurrency</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              2/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Concurrency</h1></header>
            
            
            <section><ul>
<li>
<p><strong>Simultaneous</strong> execution</p>
</li>
<li>
<p>Potentially <strong>interacting</strong> tasks</p>
</li>
<li>
<p>Examples</p>
<ul>
<li>a network server that communicates with several hundred clients all connected at once</li>
<li>a big number crunching job that spreads its work across multiple CPUs</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              3/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Multitasking</h1></header>
            
            
            <section><ul>
<li>
<p>Concurrency implies multitasking</p>
</li>
<li>
<p>If only 1 CPU is available, the only way to run multiple tasks is by rapidly switching between them</p>
</li>
</ul>
<p><img src="file:///home/matias/work/gevent_presentation/multitasking.png"/></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              4/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Parallel processing</h1></header>
            
            
            <section><ul>
<li>In the case of multiple CPUs</li>
</ul>
<p><img src="file:///home/matias/work/gevent_presentation/parallel.png"/></p>
<ul>
<li>If total number of tasks exceeds the number of CPUs, then each CPU also multitasks</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              5/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Task execution</h1></header>
            
            
            <section><ul>
<li>All tasks execute by alternating between CPU processing and I/O handling</li>
</ul>
<p><img src="file:///home/matias/work/gevent_presentation/task_exc.png"/></p>
<ul>
<li>
<p>For I/O, tasks must wait (sleep)</p>
</li>
<li>
<p>Behind the scenes, the underlying system will carry out I/O operation and wake the task when it's finished</p>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              6/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Overview of Concurrency models</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              7/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Ways to Concurrency</h1></header>
            
            
            <section><ul>
<li>
<p>Traditional multithreading</p>
<ul>
<li>OS threads</li>
<li>Shared memory, locks, etc.</li>
</ul>
</li>
<li>
<p>"Actor model" (from Erlang)</p>
<ul>
<li>Multiple processes, share nothing</li>
<li>Messaging</li>
</ul>
</li>
<li>
<p>Async or Evented I/O</p>
<ul>
<li>I/O loop + callback chains</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              8/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>OS Threads</h1></header>
            
            
            <section><ul>
<li>
<p>What most programmers think of when they hear about "concurrent programming"</p>
</li>
<li>
<p>Independent task running inside a parent program</p>
<ul>
<li>relatively lightweight</li>
<li>share the memory and state of its parent</li>
<li>gets its own stack</li>
<li>independent flow of execution</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              9/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Programming with threads is hard</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              10/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1><strong>Really</strong> hard</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              11/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Shared memory</h1></header>
            
            
            <section><ul>
<li>Tasks may run in the same memory space</li>
</ul>
<p><img src="file:///home/matias/work/gevent_presentation/shm.png"/></p>
<ul>
<li>
<p>Simultaneous access to objects </p>
</li>
<li>
<p>Often a source of unspeakable peril</p>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              12/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Access to Shared Data</h1></header>
            
            
            <section><ul>
<li>
<p>Threads share all data in your program</p>
</li>
<li>
<p>Thread scheduling is non-deterministic</p>
</li>
<li>
<p>Operations often take several steps and might be interrupted mid-stream (non-atomicity)</p>
</li>
<li>
<p>Thus, access to any kind of shared data is also non-deterministic !</p>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              13/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Problems with threads</h1></header>
            
            
            <section><ul>
<li>
<p>Race conditions</p>
<ul>
<li>The corruption of shared data due to thread scheduling is often known as a "race condition"</li>
<li>It's quite diabolical--a program may produce slightly different results each time it runs</li>
<li>Or it may just flake out mysterioulsy once every two weeks...</li>
</ul>
</li>
<li>
<p>Threads needs to be synchronized</p>
<ul>
<li>Synchronization primitives: locks, semaphores, mutexes</li>
<li>A lot harder than it seems =&gt; deadlocks, nasty corner cases   </li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              14/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Problems with threads with Python</h1></header>
            
            
            <section><ul>
<li>
<p>Global Interpreter Lock</p>
<ul>
<li>Only one Python thread can execute in the interpreter at once</li>
<li>GIL ensures each thread gets <em>exclusive</em> access to entire interpreter</li>
</ul>
</li>
<li>
<p>Whenever a thread run, it holds the GIL</p>
<ul>
<li>Impossible to have true parallelism</li>
<li>Except when having C extensions that release the GIL   </li>
</ul>
</li>
</ul>
<p><img src="file:///home/matias/work/gevent_presentation/gil_c_ext.png"/></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              15/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>The Actor Model (Erlang) "in Python"</h1></header>
            
            
            <section><ul>
<li>An alternative to threads is to run multiple independent copies of the Python interpreter<ul>
<li>In separate processes</li>
<li>Possibly on different machines</li>
<li>Get the interpreters to communicate through "message passing" (IPC)<ul>
<li>Pipes, FIFOs, memory mapped regions, sockets, etc.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="file:///home/matias/work/gevent_presentation/distributed.png"/></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              16/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Multiprocessing module</h1></header>
            
            
            <section><ul>
<li>
<p>Multiprocessing module is part of standard Python since 2.6</p>
<ul>
<li>It mirrors Python's threading API</li>
</ul>
</li>
<li>
<p>Messaging implies serialization</p>
<ul>
<li>convert Python objects to a byte stream </li>
<li>done through the standard "pickle" module</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              17/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>The third path to Concurrency: Async. or Evented I/O</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              18/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>CPU bound tasks</h1></header>
            
            
            <section><ul>
<li>
<p>A task is "CPU bound" if it spends most of its time with little I/O</p>
</li>
<li>
<p>Examples</p>
<ul>
<li>Crunching big matrices</li>
<li>Image processing</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              19/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>I/O bound tasks</h1></header>
            
            
            <section><ul>
<li>
<p>A task is "I/O bound" if it spends most of its time waiting for I/O</p>
</li>
<li>
<p>Examples</p>
<ul>
<li>Reading input from user</li>
<li>GUI</li>
<li>Networking</li>
<li>File processing</li>
</ul>
</li>
<li>
<p><strong>Most programs are I/O bound</strong></p>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              20/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Async. or Evented I/O</h1></header>
            
            
            <section><ul>
<li>
<p>"non-blocking I/O"</p>
</li>
<li>
<p>permits other processing to continue before I/O operation has completed</p>
<ul>
<li>one of the main function of Operating Systems (e.g old "select" sys. call)</li>
</ul>
</li>
<li>
<p>more scalable than threads or processes (much less memory consumption)</p>
</li>
<li>
<p>usually gives great response time, latency and CPU usage on I/O bound programs</p>
</li>
<li>
<p>one single main thread (SPED: Single Process Event Driven)</p>
<ul>
<li>lots of troubles are avoided, easier to debug</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              21/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Async. or Evented I/O</h1></header>
            
            
            <section><ul>
<li>
<p>No silver bullet, though</p>
<ul>
<li>a loop has to run to dispatch I/O operations</li>
<li>callbacks "spaghetti" make code less readable</li>
</ul>
</li>
<li>
<p>Recent progress on Linux kernel since 2.6 (better threading) and 64-bits
architecture (more memory) make it less interesting than before in
term of pure performance</p>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              22/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>What is the best approach ?</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              23/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Depends on the problem :)</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              24/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>The C10k problem (D. Kegel, 1999)</h1></header>
            
            
            <section><ul>
<li>Comes from web servers world <em>(I/O bound process)</em><ul>
<li>How to handle 10.000 simultaneous connections ?</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              25/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>The C10k problem (D. Kegel, 1999)</h1></header>
            
            
            <section><ul>
<li>Since 1999, solutions have emerged<ul>
<li>2002: Nginx, Lighttpd<ul>
<li>successfully uses the Asynchronous I/O paradigm</li>
<li>1 single thread to serve them all</li>
</ul>
</li>
<li>2003: "Why events are a bad idea (for High-concurrency servers)"<ul>
<li>paper from Behren, Condit and Brewer (University of California, Berkeley)</li>
<li>read the paper! Conclusions:<ul>
<li>weaknesses of threads (in term of performance) are artifacts of
  current implementations</li>
<li>compilers <em>will</em> evolve to help with thread safety issues</li>
<li>threads =&gt; classic programming model (no I/O callbacks)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              26/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p><img src="file:///home/matias/work/gevent_presentation/futurama_character.jpg"/></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              27/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p><img src="file:///home/matias/work/gevent_presentation/willywonka.jpg"/></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              28/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>2nd part: <strong>gevent</strong></h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              29/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>What is gevent ?</h1></header>
            
            
            <section><ul>
<li>
<p>Python concurrency library</p>
</li>
<li>
<p>based around:</p>
<ul>
<li><a href="http://software.schmorp.de/pkg/libev.html">libev</a></li>
<li><a href="http://greenlet.readthedocs.org/en/latest/">greenlet</a></li>
</ul>
</li>
<li>
<p>clean API for a variety of concurrency and network related tasks </p>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              30/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Talk is cheap - show me the code</h1></header>
            
            
            <section><ul>
<li>Download of 4 files over the Internet<ul>
<li>Using threads</li>
<li>Using async I/O</li>
<li>Using gevent</li>
</ul>
</li>
</ul>
<p>Files are taken from the W3C web site: http://www.w3.org</p>
<div class="highlight"><pre><span class="lineno">1</span> <span class="n">files</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;/TR/html401/html40.txt&quot;</span><span class="p">,</span> 
<span class="lineno">2</span>          <span class="s">&quot;/TR/2002/REC-xhtml1-20020801/xhtml1.pdf&quot;</span><span class="p">,</span>
<span class="lineno">3</span>          <span class="s">&quot;/TR/REC-html32.html&quot;</span><span class="p">,</span>
<span class="lineno">4</span>          <span class="s">&quot;/TR/2000/REC-DOM-Level-2-Core-20001113/DOM2-Core.txt&quot;</span><span class="p">)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              31/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Threaded version</h1></header>
            
            
            <section><div class="highlight"><pre><span class="lineno"> 1</span> <span class="k">class</span> <span class="nc">download_task</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
<span class="lineno"> 2</span>   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="s">&quot;proxy.esrf.fr:3128&quot;</span><span class="p">):</span>
<span class="lineno"> 3</span>     <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span>     <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
<span class="lineno"> 6</span>     <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">filepath</span>
<span class="lineno"> 7</span>     <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="n">proxy</span>
<span class="lineno"> 8</span>     <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span>   <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">11</span>     <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="lineno">12</span>     <span class="n">proxy_host</span><span class="p">,</span> <span class="n">proxy_port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
<span class="lineno">13</span>     <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">proxy_host</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">proxy_port</span><span class="p">)))</span>
<span class="lineno">14</span> 
<span class="lineno">15</span>     <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;GET http://&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="s">&quot; HTTP/1.0</span><span class="se">\r\n\r\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="lineno">16</span> 
<span class="lineno">17</span>     <span class="n">buf</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno">18</span>     <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
<span class="lineno">19</span>       <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="lineno">20</span>       <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
<span class="lineno">21</span>         <span class="k">break</span>
<span class="lineno">22</span>       <span class="n">buf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="lineno">23</span> 
<span class="lineno">24</span>     <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="lineno">25</span>     <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="lineno">26</span> 
<span class="lineno">27</span> <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno">28</span> <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
<span class="lineno">29</span>   <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">download_task</span><span class="p">(</span><span class="s">&quot;www.w3.org&quot;</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="s">&quot;proxy.esrf.fr:3128&quot;</span><span class="p">))</span>
<span class="lineno">30</span> <span class="p">[</span><span class="n">task</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">]</span>
<span class="lineno">31</span> <span class="p">[</span><span class="n">task</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">]</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              32/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Asynchronous flavor</h1></header>
            
            
            <section><p>Use of the 'asyncore' standard Python module. Callbacks are
fired when socket is ready to do a non-blocking read or
write operation.</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="k">class</span> <span class="nc">download_task</span><span class="p">(</span><span class="n">asyncore</span><span class="o">.</span><span class="n">dispatcher</span><span class="p">):</span>
<span class="lineno"> 2</span>   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="s">&quot;proxy.esrf.fr:3128&quot;</span><span class="p">):</span>
<span class="lineno"> 3</span>     <span class="n">asyncore</span><span class="o">.</span><span class="n">dispatcher</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span>     <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
<span class="lineno"> 6</span>     <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">filepath</span>
<span class="lineno"> 7</span>     <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="n">proxy</span>
<span class="lineno"> 8</span>     <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno"> 9</span>     <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="lineno">10</span>     <span class="bp">self</span><span class="o">.</span><span class="n">request_sent</span> <span class="o">=</span> <span class="bp">False</span>
<span class="lineno">11</span> 
<span class="lineno">12</span>   <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">13</span>     <span class="bp">self</span><span class="o">.</span><span class="n">create_socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="lineno">14</span>     <span class="n">proxy_host</span><span class="p">,</span> <span class="n">proxy_port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
<span class="lineno">15</span>     <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">proxy_host</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">proxy_port</span><span class="p">)))</span>
<span class="lineno">16</span> 
<span class="lineno">17</span>   <span class="k">def</span> <span class="nf">handle_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">18</span>     <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="lineno">19</span>     <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span>
<span class="lineno">20</span> 
<span class="lineno">21</span>   <span class="k">def</span> <span class="nf">handle_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">22</span>     <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="lineno">23</span>     <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="lineno">24</span> 
<span class="lineno">25</span>   <span class="k">def</span> <span class="nf">writable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">26</span>     <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_sent</span>
<span class="lineno">27</span> 
<span class="lineno">28</span>   <span class="k">def</span> <span class="nf">handle_write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">29</span>     <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;GET http://&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="s">&quot; HTTP/1.0</span><span class="se">\r\n\r\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="lineno">30</span>     <span class="bp">self</span><span class="o">.</span><span class="n">request_sent</span> <span class="o">=</span> <span class="bp">True</span>
<span class="lineno">31</span> 
<span class="lineno">32</span> <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno">33</span> <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
<span class="lineno">34</span>   <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">download_task</span><span class="p">(</span><span class="s">&quot;www.w3.org&quot;</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="s">&quot;proxy.esrf.fr:3128&quot;</span><span class="p">))</span>
<span class="lineno">35</span> <span class="p">[</span><span class="n">task</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">]</span>
<span class="lineno">36</span> 
<span class="lineno">37</span> <span class="n">asyncore</span><span class="o">.</span><span class="n">loop</span><span class="p">()</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              33/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Gevent version</h1></header>
            
            
            <section><p>A synchronous adapter for fully asynchronous communication, without callbacks</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="k">def</span> <span class="nf">download_task</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="s">&quot;proxy.esrf.fr:3128&quot;</span><span class="p">):</span>
<span class="lineno"> 2</span>   <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="lineno"> 3</span>   <span class="n">proxy_host</span><span class="p">,</span> <span class="n">proxy_port</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
<span class="lineno"> 4</span>   <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">proxy_host</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">proxy_port</span><span class="p">)))</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span>   <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;GET http://&quot;</span><span class="o">+</span><span class="n">host</span><span class="o">+</span><span class="n">filepath</span><span class="o">+</span><span class="s">&quot; HTTP/1.0</span><span class="se">\r\n\r\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span>   <span class="n">buf</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno"> 9</span>   <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
<span class="lineno">10</span>     <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="lineno">11</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
<span class="lineno">12</span>       <span class="k">break</span>
<span class="lineno">13</span>     <span class="n">buf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="lineno">14</span> 
<span class="lineno">15</span>   <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="lineno">16</span>   <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="lineno">17</span> 
<span class="lineno">18</span> <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno">19</span> <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
<span class="lineno">20</span>   <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gevent</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">download_task</span><span class="p">,</span> <span class="s">&quot;www.w3.org&quot;</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="s">&quot;proxy.esrf.fr:3128&quot;</span><span class="p">))</span>
<span class="lineno">21</span> <span class="n">gevent</span><span class="o">.</span><span class="n">joinall</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              34/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>How does it work ?</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              35/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p><img src="file:///home/matias/work/gevent_presentation/greenlet_bird.jpg"/></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              36/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>greenlet</h1></header>
            
            
            <section><ul>
<li>
<p>greenlet provides <strong>coroutines</strong> to Python via a C extension module</p>
</li>
<li>
<p>spin-off of <strong>Stackless</strong>, a version of Python supporting micro-threads</p>
<ul>
<li>micro-threads are coroutines + a scheduler</li>
</ul>
</li>
<li>
<p>the idea of coroutine is from a 1963 paper from Melvin Conway</p>
<ul>
<li>like a normal subroutine, except that it has <em>yielding points</em>
  instead of a single return exit</li>
<li>when yielding, execution goes to another coroutine</li>
</ul>
</li>
<li>
<p><strong>gevent trick #1</strong>: yield automatically when doing blocking I/O
  (or when 'sleeping')</p>
<ul>
<li>libev provides efficient async. I/O and a scheduler</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              37/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>greenlet</h1></header>
            
            
            <section><p>Execution flow example</p>
<p><img src="file:///home/matias/work/gevent_presentation/flow.gif"/></p>
<p>Greenlets execution is deterministic. No preemption.</p>
<p><strong>Cooperative scheduling</strong></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              38/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p><img src="file:///home/matias/work/gevent_presentation/anxiety_cat.jpg"/></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              39/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1><strong>gevent trick #2</strong> to the rescue</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              40/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Monkey-patching</h1></header>
            
            
            <section><h3>from gevent import monkey; monkey.patch_all()</h3>
<ul>
<li>
<p>Python allows for most objects to be modified at runtime including modules, classes, and even functions</p>
<ul>
<li>this is generally an astoudingly bad idea!!!</li>
<li>nevertheless in extreme situations where a library needs to alter the fundamental behavior of Python itself monkey      patches can be used</li>
</ul>
</li>
<li>
<p>gevent patches blocking system calls in the standard library including those in socket, ssl, threading and select modules to instead behave cooperatively</p>
</li>
<li>
<p>Beware</p>
<ul>
<li>libraries that wrap C libraries<ul>
<li>it is possible to patch those: <a href="https://github.com/hongqn/greenify">greenify</a> (but requires recompiling)</li>
</ul>
</li>
<li>disk I/O</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              41/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p><img src="file:///home/matias/work/gevent_presentation/monkey.jpg"/></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              42/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>gevent features</h1></header>
            
            
            <section><ul>
<li>
<p>Greenlet objects (aka <strong>tasks</strong>)</p>
<ul>
<li>spawn, spawn_later, pause, kill, join...</li>
<li>ready, link, get<ul>
<li>can even be used to implement <strong>futures</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Since gevent 1.0, <strong>gevent.threadpool</strong> helps running blocking code in real OS threads, synchronized with gevent loop</p>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              43/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>gevent features</h1></header>
            
            
            <section><p>Timeouts</p>
<div class="highlight"><pre><span class="lineno">1</span> <span class="k">with</span> <span class="n">gevent</span><span class="o">.</span><span class="n">Timeout</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<span class="lineno">2</span>   <span class="n">response</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="lineno">3</span>   <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
<span class="lineno">4</span>     <span class="k">print</span> <span class="n">line</span>
<span class="lineno">5</span> <span class="c"># raises Timeout exception if not done after 5 seconds</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              44/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>gevent features</h1></header>
            
            
            <section><ul>
<li>API<ul>
<li>Event &amp; AsyncResult objects</li>
<li>Queues</li>
<li>Greenlets Groups &amp; Pool</li>
<li>TCP, SSL &amp; WSGI servers</li>
<li>Locks and Semaphores (almost never needed)</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              45/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>gevent and Python 3</h1></header>
            
            
            <section><ul>
<li>
<p>Python 3.4 introduces Tulip (asyncio module)</p>
<ul>
<li>will be in a final shape in Python 3.5</li>
<li>native support for asynchronous I/O</li>
</ul>
</li>
<li>
<p>gevent embraces the change</p>
<ul>
<li>received many contributions from the community</li>
<li>working implementation compatible with Python 3 in <a href="https://github.com/surfly/gevent">gevent repository</a></li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              46/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Third part: gevent in a bottle</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              47/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Bottle: Python web framework</h1></header>
            
            
            <section><p><img src="file:///home/matias/work/gevent_presentation/bottle.png"/></p>
<ul>
<li>
<p>Lightweight WSGI <strong>micro</strong> framework</p>
<ul>
<li>one single Python module file !</li>
<li>no dependencies other than standard library</li>
<li>runs on Python 2.5+ and 3.x</li>
</ul>
</li>
<li>
<p><a href="http://bottlepy.org">Link to web page</a></p>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              48/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Bottle: Python web framework</h1></header>
            
            
            <section><ul>
<li>
<p>Designed for prototyping and building small web applications and services</p>
<ul>
<li>compares to <a href="http://flask.pocoo.org/">Flask</a></li>
<li>pushes the single-file approach to the limit</li>
</ul>
</li>
<li>
<p>Misses some advanced features and ready-to-use solutions found in other frameworks</p>
<ul>
<li>MVC</li>
<li>ORM (Object-Relational Mapping)</li>
<li>Scaffolding (automatic code generation for application database control), made popular by Ruby On Rails</li>
<li>Form validation</li>
<li>XML-RPC </li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              49/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Luckily we don't need all this to have fun :)</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              50/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Asynchronous Applications with Bottle+gevent</h1></header>
            
            
            <section><ul>
<li>
<p>Most servers limit the size of their worker pools to a low number of concurrent OS threads</p>
<ul>
<li>expensive to create for a large number of connections</li>
</ul>
</li>
<li>
<p>Asynchronous design patterns dont mix well with the synchronous nature of WSGI</p>
<ul>
<li>most asynchronous frameworks (tornado, twisted...) implemented a specialized API</li>
</ul>
</li>
<li>
<p>gevent applications are massively "multi-threaded" with greenlets</p>
<ul>
<li>the best of both worlds</li>
<li>writing asynchronous applications is extremely easy, as they look and feel like synchronous </li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              51/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: gevent_pyugg.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Thanks for your attention :) Questions ?</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="gevent_pyugg.md">gevent_pyugg.md</a>
            </aside>
            
            <aside class="page_number">
              52/52
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source:  -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="page_number">
              /52
            </aside>
          </footer>
        </div>
      </div>
      
    </div>
  </div>
  
  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>
      
      <tr id="toc-row-1">
        <th><a href="#slide1">Introduction to <strong>gevent</strong></a></th>
        <td><a href="#slide1">1</a></td>
      </tr>
      
      
      <tr id="toc-row-2">
        <th><a href="#slide2">A refresher on Concurrency</a></th>
        <td><a href="#slide2">2</a></td>
      </tr>
      
      
      <tr id="toc-row-3">
        <th><a href="#slide3">Concurrency</a></th>
        <td><a href="#slide3">3</a></td>
      </tr>
      
      
      <tr id="toc-row-4">
        <th><a href="#slide4">Multitasking</a></th>
        <td><a href="#slide4">4</a></td>
      </tr>
      
      
      <tr id="toc-row-5">
        <th><a href="#slide5">Parallel processing</a></th>
        <td><a href="#slide5">5</a></td>
      </tr>
      
      
      <tr id="toc-row-6">
        <th><a href="#slide6">Task execution</a></th>
        <td><a href="#slide6">6</a></td>
      </tr>
      
      
      <tr id="toc-row-7">
        <th><a href="#slide7">Overview of Concurrency models</a></th>
        <td><a href="#slide7">7</a></td>
      </tr>
      
      
      <tr id="toc-row-8">
        <th><a href="#slide8">Ways to Concurrency</a></th>
        <td><a href="#slide8">8</a></td>
      </tr>
      
      
      <tr id="toc-row-9">
        <th><a href="#slide9">OS Threads</a></th>
        <td><a href="#slide9">9</a></td>
      </tr>
      
      
      <tr id="toc-row-10">
        <th><a href="#slide10">Programming with threads is hard</a></th>
        <td><a href="#slide10">10</a></td>
      </tr>
      
      
      <tr id="toc-row-11">
        <th><a href="#slide11"><strong>Really</strong> hard</a></th>
        <td><a href="#slide11">11</a></td>
      </tr>
      
      
      <tr id="toc-row-12">
        <th><a href="#slide12">Shared memory</a></th>
        <td><a href="#slide12">12</a></td>
      </tr>
      
      
      <tr id="toc-row-13">
        <th><a href="#slide13">Access to Shared Data</a></th>
        <td><a href="#slide13">13</a></td>
      </tr>
      
      
      <tr id="toc-row-14">
        <th><a href="#slide14">Problems with threads</a></th>
        <td><a href="#slide14">14</a></td>
      </tr>
      
      
      <tr id="toc-row-15">
        <th><a href="#slide15">Problems with threads with Python</a></th>
        <td><a href="#slide15">15</a></td>
      </tr>
      
      
      <tr id="toc-row-16">
        <th><a href="#slide16">The Actor Model (Erlang) "in Python"</a></th>
        <td><a href="#slide16">16</a></td>
      </tr>
      
      
      <tr id="toc-row-17">
        <th><a href="#slide17">Multiprocessing module</a></th>
        <td><a href="#slide17">17</a></td>
      </tr>
      
      
      <tr id="toc-row-18">
        <th><a href="#slide18">The third path to Concurrency: Async. or Evented I/O</a></th>
        <td><a href="#slide18">18</a></td>
      </tr>
      
      
      <tr id="toc-row-19">
        <th><a href="#slide19">CPU bound tasks</a></th>
        <td><a href="#slide19">19</a></td>
      </tr>
      
      
      <tr id="toc-row-20">
        <th><a href="#slide20">I/O bound tasks</a></th>
        <td><a href="#slide20">20</a></td>
      </tr>
      
      
      <tr id="toc-row-21">
        <th><a href="#slide21">Async. or Evented I/O</a></th>
        <td><a href="#slide21">21</a></td>
      </tr>
      
      
      <tr id="toc-row-22">
        <th><a href="#slide22">Async. or Evented I/O</a></th>
        <td><a href="#slide22">22</a></td>
      </tr>
      
      
      <tr id="toc-row-23">
        <th><a href="#slide23">What is the best approach ?</a></th>
        <td><a href="#slide23">23</a></td>
      </tr>
      
      
      <tr id="toc-row-24">
        <th><a href="#slide24">Depends on the problem :)</a></th>
        <td><a href="#slide24">24</a></td>
      </tr>
      
      
      <tr id="toc-row-25">
        <th><a href="#slide25">The C10k problem (D. Kegel, 1999)</a></th>
        <td><a href="#slide25">25</a></td>
      </tr>
      
      
      <tr id="toc-row-26">
        <th><a href="#slide26">The C10k problem (D. Kegel, 1999)</a></th>
        <td><a href="#slide26">26</a></td>
      </tr>
      
      
      <tr id="toc-row-27">
        <th><a href="#slide27">-</a></th>
        <td><a href="#slide27">27</a></td>
      </tr>
      
      
      <tr id="toc-row-28">
        <th><a href="#slide28">-</a></th>
        <td><a href="#slide28">28</a></td>
      </tr>
      
      
      <tr id="toc-row-29">
        <th><a href="#slide29">2nd part: <strong>gevent</strong></a></th>
        <td><a href="#slide29">29</a></td>
      </tr>
      
      
      <tr id="toc-row-30">
        <th><a href="#slide30">What is gevent ?</a></th>
        <td><a href="#slide30">30</a></td>
      </tr>
      
      
      <tr id="toc-row-31">
        <th><a href="#slide31">Talk is cheap - show me the code</a></th>
        <td><a href="#slide31">31</a></td>
      </tr>
      
      
      <tr id="toc-row-32">
        <th><a href="#slide32">Threaded version</a></th>
        <td><a href="#slide32">32</a></td>
      </tr>
      
      
      <tr id="toc-row-33">
        <th><a href="#slide33">Asynchronous flavor</a></th>
        <td><a href="#slide33">33</a></td>
      </tr>
      
      
      <tr id="toc-row-34">
        <th><a href="#slide34">Gevent version</a></th>
        <td><a href="#slide34">34</a></td>
      </tr>
      
      
      <tr id="toc-row-35">
        <th><a href="#slide35">How does it work ?</a></th>
        <td><a href="#slide35">35</a></td>
      </tr>
      
      
      <tr id="toc-row-36">
        <th><a href="#slide36">-</a></th>
        <td><a href="#slide36">36</a></td>
      </tr>
      
      
      <tr id="toc-row-37">
        <th><a href="#slide37">greenlet</a></th>
        <td><a href="#slide37">37</a></td>
      </tr>
      
      
      <tr id="toc-row-38">
        <th><a href="#slide38">greenlet</a></th>
        <td><a href="#slide38">38</a></td>
      </tr>
      
      
      <tr id="toc-row-39">
        <th><a href="#slide39">-</a></th>
        <td><a href="#slide39">39</a></td>
      </tr>
      
      
      <tr id="toc-row-40">
        <th><a href="#slide40"><strong>gevent trick #2</strong> to the rescue</a></th>
        <td><a href="#slide40">40</a></td>
      </tr>
      
      
      <tr id="toc-row-41">
        <th><a href="#slide41">Monkey-patching</a></th>
        <td><a href="#slide41">41</a></td>
      </tr>
      
      
      <tr id="toc-row-42">
        <th><a href="#slide42">-</a></th>
        <td><a href="#slide42">42</a></td>
      </tr>
      
      
      <tr id="toc-row-43">
        <th><a href="#slide43">gevent features</a></th>
        <td><a href="#slide43">43</a></td>
      </tr>
      
      
      <tr id="toc-row-44">
        <th><a href="#slide44">gevent features</a></th>
        <td><a href="#slide44">44</a></td>
      </tr>
      
      
      <tr id="toc-row-45">
        <th><a href="#slide45">gevent features</a></th>
        <td><a href="#slide45">45</a></td>
      </tr>
      
      
      <tr id="toc-row-46">
        <th><a href="#slide46">gevent and Python 3</a></th>
        <td><a href="#slide46">46</a></td>
      </tr>
      
      
      <tr id="toc-row-47">
        <th><a href="#slide47">Third part: gevent in a bottle</a></th>
        <td><a href="#slide47">47</a></td>
      </tr>
      
      
      <tr id="toc-row-48">
        <th><a href="#slide48">Bottle: Python web framework</a></th>
        <td><a href="#slide48">48</a></td>
      </tr>
      
      
      <tr id="toc-row-49">
        <th><a href="#slide49">Bottle: Python web framework</a></th>
        <td><a href="#slide49">49</a></td>
      </tr>
      
      
      <tr id="toc-row-50">
        <th><a href="#slide50">Luckily we don't need all this to have fun :)</a></th>
        <td><a href="#slide50">50</a></td>
      </tr>
      
      
      <tr id="toc-row-51">
        <th><a href="#slide51">Asynchronous Applications with Bottle+gevent</a></th>
        <td><a href="#slide51">51</a></td>
      </tr>
      
      
      <tr id="toc-row-52">
        <th><a href="#slide52">Thanks for your attention :) Questions ?</a></th>
        <td><a href="#slide52">52</a></td>
      </tr>
      
      
    </table>
  </div>
  
  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Expos</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Full screen slides</th>
        <td>e</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide slide context</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
  </div>
  <script>main()</script>
</body>
</html>