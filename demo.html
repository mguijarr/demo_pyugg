<html>
  <body>
   <h1>Hello, PyUGG!</h1>
   <div style="float: left;">
     <canvas id="webcam_display" width="640" height="480"
      style="border:1px solid #000000;">
     </canvas>
   </div>
   <div style="float: left;">
     <button onclick="JavaScript:dummy_request();">Test Long Polling</button>
   </div>

   <script>
     var jpeg_data;
     var c = document.getElementById("webcam_display");
     var ctx = c.getContext("2d");
     ctx.fillStyle = "#CCCCCC";
     ctx.fillRect(0,0,640,480);

     var jpeg = new Image();
     jpeg.onload = function() {
       ctx.drawImage(this, 0, 0, c.width, c.height);
     };

     function display_data() {
       jpeg.src = "data:image/jpeg;base64,"+jpeg_data;
     };

     var source = new EventSource("stream");
     source.addEventListener("message", function(e) {
       jpeg_data = e.data;
       requestAnimationFrame(display_data); 
     }, false);

     function dummy_request() {
       var xhr = new XMLHttpRequest();
       xhr.onreadystatechange = function() {
         if (this.readyState == 4) {
           alert(this.responseText); 
         }
       };
       xhr.open("GET","dummy_request", true);
       xhr.send(null);
     };
   </script>
 </body>
</html>
